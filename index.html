<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PET æ™ºæ…§æ’ç¨‹åŠ©æ‰‹</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --pink-50: #fdf2f8;
            --pink-100: #fce7f3;
            --pink-200: #fbcfe8;
            --pink-300: #f9a8d4;
            --pink-400: #f472b6;
            --pink-500: #ec4899;
            --rose-50: #fff1f2;
            --rose-100: #ffe4e6;
            --lavender-50: #faf5ff;
            --lavender-100: #f3e8ff;
            --lavender-200: #e9d5ff;
            --mint-50: #f0fdf4;
            --mint-100: #dcfce7;
            --mint-200: #bbf7d0;
            --peach-50: #fff7ed;
            --peach-100: #ffedd5;
            --cream: #fffbf7;
            --warm-gray-50: #fafaf9;
            --warm-gray-100: #f5f5f4;
            --warm-gray-200: #e7e5e4;
            --warm-gray-600: #78716c;
            --warm-gray-700: #57534e;
            --warm-gray-800: #44403c;
        }

        * {
            font-family: 'Nunito', 'Segoe UI', system-ui, sans-serif;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            background: linear-gradient(135deg, var(--pink-50) 0%, var(--lavender-50) 50%, var(--mint-50) 100%);
            min-height: 100vh;
        }

        /* å‘¼å¸ç‡ˆå‹•ç•« */
        @keyframes pulse-soft {

            0%,
            100% {
                opacity: 1;
                box-shadow: 0 0 0 0 rgba(251, 146, 60, 0.3);
            }

            50% {
                opacity: 0.85;
                box-shadow: 0 0 12px 4px rgba(251, 146, 60, 0.2);
            }
        }

        .pulse-delayed {
            animation: pulse-soft 2.5s ease-in-out infinite;
        }

        /* åˆ—å°å„ªåŒ– - åªå° æ‰“è—¥æ™‚åˆ»è¡¨ å’Œ åŸ·è¡Œæ¸…å–® */
        @media print {
            body * {
                visibility: hidden;
            }

            .printable-section,
            .printable-section * {
                visibility: visible !important;
            }

            .printable-section {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                margin-bottom: 24px;
                page-break-inside: avoid;
            }

            .printable-section:nth-of-type(2) {
                position: relative;
                margin-top: 24px;
            }

            .no-print {
                display: none !important;
            }

            .print-only {
                display: block !important;
            }

            body {
                background: white !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            .card {
                box-shadow: none !important;
                border: 1px solid #e5e7eb !important;
            }
        }

        .print-only {
            display: none;
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .card {
                border-radius: 12px !important;
            }

            table {
                font-size: 12px !important;
            }

            th,
            td {
                padding: 10px 8px !important;
            }

            /* æ‰‹æ©Ÿè¼¸å…¥å„ªåŒ– */
            .input-soft {
                font-size: 16px !important;
                /* é˜²æ­¢ iOS æ”¾å¤§ */
                padding: 12px 16px !important;
                min-height: 48px;
            }

            .config-grid {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 12px !important;
            }

            .patient-input {
                font-size: 36px !important;
            }
        }

        @media (max-width: 480px) {
            table {
                font-size: 11px !important;
            }

            th,
            td {
                padding: 8px 6px !important;
            }

            .config-grid {
                grid-template-columns: 1fr !important;
            }

            .tab-btn {
                padding: 10px 16px !important;
                font-size: 13px !important;
            }
        }

        /* FA Icon æ¨£å¼ */
        .icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        /* æŒ‰éˆ• hover æ•ˆæœ */
        .btn-soft {
            transition: all 0.2s ease;
        }

        .btn-soft:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .btn-soft:active {
            transform: translateY(0);
        }

        /* å¡ç‰‡ */
        .card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
            border: 1px solid rgba(0, 0, 0, 0.04);
        }

        /* è¡¨æ ¼è¡Œ hover */
        .table-row:hover {
            background: var(--pink-50);
        }

        /* è¼¸å…¥æ¡† */
        .input-soft {
            border: 2px solid var(--warm-gray-200);
            border-radius: 12px;
            padding: 10px 16px;
            font-size: 15px;
            transition: all 0.2s ease;
            outline: none;
        }

        .input-soft:focus {
            border-color: var(--pink-300);
            box-shadow: 0 0 0 3px rgba(249, 168, 212, 0.2);
        }

        /* ç”˜ç‰¹åœ–æ¢ */
        .gantt-bar {
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .gantt-bar:hover {
            filter: brightness(1.05);
            transform: scaleY(1.15);
        }

        /* åˆ‡æ–·é»æ¨£å¼ */
        .cutoff-row {
            background: linear-gradient(90deg, var(--peach-50) 0%, var(--peach-100) 100%);
            border-left: 3px solid #fb923c;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo } = React;

        // ============ é è¨­åƒæ•¸ ============
        const DEFAULT_CONFIG = {
            startTime: "08:30",
            earlyScanDuration: 35,
            delayedScanDuration: 20,
            uptakeTime: 60,
            minWaitLimit: 100,   // æ‰“è—¥åˆ° Delayed é–‹å§‹ çš„æœ€å°æ™‚é–“
            maxWaitLimit: 150,   // æ‰“è—¥åˆ° Delayed é–‹å§‹ çš„æœ€å¤§æ™‚é–“
            lunchBreakEnabled: false,
            lunchBreakStart: "12:00",
            lunchBreakEnd: "13:00",
        };

        // ============ å·¥å…·å‡½æ•¸ ============
        const timeToMinutes = (timeStr) => {
            const [h, m] = timeStr.split(':').map(Number);
            return h * 60 + m;
        };

        const minutesToTime = (minutes) => {
            const h = Math.floor(minutes / 60);
            const m = minutes % 60;
            return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;
        };

        // ============ æ ¸å¿ƒæ’ç¨‹æ¼”ç®—æ³•ï¼ˆçœŸæ­£è‡ªå‹•æœ€ä½³åŒ– + åˆä¼‘æ”¯æ´ï¼‰ ============
        // ç­–ç•¥ï¼šè‡ªå‹•åˆ†æ‰¹ + å‹•æ…‹èª¿æ•´æ‰“è—¥æ™‚é–“ + åˆä¼‘é¿é–‹ï¼Œç¢ºä¿æ‰€æœ‰äººéƒ½ä¸è¶…æ™‚
        const calculateSchedule = (patientCount, config) => {
            const {
                startTime,
                earlyScanDuration,
                delayedScanDuration,
                uptakeTime,
                minWaitLimit,
                maxWaitLimit,
                lunchBreakEnabled,
                lunchBreakStart,
                lunchBreakEnd,
            } = config;

            const startMinutes = timeToMinutes(startTime);
            const n = patientCount;

            // åˆä¼‘æ™‚é–“ï¼ˆåˆ†é˜ï¼‰
            const lunchStart = lunchBreakEnabled ? timeToMinutes(lunchBreakStart) : null;
            const lunchEnd = lunchBreakEnabled ? timeToMinutes(lunchBreakEnd) : null;

            // æª¢æŸ¥æ™‚é–“æ˜¯å¦èˆ‡åˆä¼‘è¡çªï¼Œå¦‚æœè¡çªå‰‡è·³éåˆä¼‘
            const adjustForLunch = (proposedStart, duration) => {
                if (!lunchBreakEnabled) return proposedStart;
                const proposedEnd = proposedStart + duration;
                // å¦‚æœæƒææœƒè·¨è¶Šåˆä¼‘é–‹å§‹æ™‚é–“ï¼Œå‰‡å»¶å¾Œåˆ°åˆä¼‘çµæŸ
                if (proposedStart < lunchEnd && proposedEnd > lunchStart) {
                    return lunchEnd;
                }
                return proposedStart;
            };

            if (n === 0) {
                return { mode: 'EMPTY', schedule: [], batches: [] };
            }

            // ===== å¦‚æœ delayedScanDuration = 0ï¼Œè¡¨ç¤ºä¸éœ€è¦ Delayed Scan =====
            const needDelayed = delayedScanDuration > 0;

            if (!needDelayed) {
                // åƒ… Early æ¨¡å¼ï¼šé€£çºŒæ’ç¨‹ï¼Œä¸éœ€åˆ†æ‰¹
                const schedule = [];
                let machineTime = startMinutes + uptakeTime;

                for (let i = 0; i < n; i++) {
                    let earlyStart = machineTime;
                    earlyStart = adjustForLunch(earlyStart, earlyScanDuration);

                    const injTime = earlyStart - uptakeTime;
                    const earlyEnd = earlyStart + earlyScanDuration;

                    schedule.push({
                        id: i + 1,
                        batch: 1,
                        injTime,
                        earlyStart,
                        earlyEnd,
                        delayedStart: null,
                        delayedEnd: null,
                    });

                    machineTime = earlyEnd;
                }

                const firstInj = schedule[0].injTime;
                const lastEnd = schedule[n - 1].earlyEnd;

                return {
                    mode: 'EARLY_ONLY',
                    schedule,
                    batches: [{ batchNumber: 1, patients: schedule.map(p => p.id), firstInj, lastDelayedEnd: lastEnd }],
                    maxBatchSize: n,
                    maxPatientWaitTime: null,
                    minPatientWaitTime: null,
                    totalDuration: lastEnd - firstInj,
                    summary: `åƒ… Early Scan æ¨¡å¼ï¼š${n} ä½ç—…äººé€£çºŒè™•ç†`,
                };
            }

            // ===== é—œéµè¨ˆç®—ï¼šæ¯æ‰¹æœ€å¤šå¯é€£çºŒåšå¹¾å€‹ Early =====
            const maxBatchSize = Math.floor((maxWaitLimit - uptakeTime) / earlyScanDuration);

            if (maxBatchSize < 1) {
                return {
                    mode: 'ERROR',
                    schedule: [],
                    batches: [],
                    error: `åƒæ•¸ä¸åˆç†ï¼šuptakeTime (${uptakeTime}) + è‡³å°‘ä¸€æ¬¡æƒæ å·²è¶…é maxWaitLimit (${maxWaitLimit})`
                };
            }

            // ===== åˆ†æ‰¹è™•ç†ï¼ˆæ”¯æ´åˆä¼‘ï¼‰ =====
            const schedule = [];
            const batches = [];
            let machineTime = startMinutes + uptakeTime;
            let patientId = 1;
            let batchNumber = 1;

            while (patientId <= n) {
                const batchSize = Math.min(maxBatchSize, n - patientId + 1);
                const batchPatients = [];

                // é€™ä¸€æ‰¹çš„æ‰“è—¥å’Œ Early
                for (let i = 0; i < batchSize; i++) {
                    // è¨ˆç®— Early é–‹å§‹æ™‚é–“ï¼Œè€ƒæ…®åˆä¼‘
                    let earlyStart = machineTime + i * earlyScanDuration;
                    earlyStart = adjustForLunch(earlyStart, earlyScanDuration);

                    // å¦‚æœå› åˆä¼‘èª¿æ•´äº† Earlyï¼Œå¾ŒçºŒçš„ä¹Ÿéœ€è¦é‡æ–°è¨ˆç®—
                    if (i > 0) {
                        const prevEnd = batchPatients[i - 1].earlyEnd;
                        earlyStart = Math.max(earlyStart, prevEnd);
                        earlyStart = adjustForLunch(earlyStart, earlyScanDuration);
                    }

                    const injTime = earlyStart - uptakeTime;
                    const earlyEnd = earlyStart + earlyScanDuration;

                    const patient = {
                        id: patientId + i,
                        batch: batchNumber,
                        injTime,
                        earlyStart,
                        earlyEnd,
                        delayedStart: null,
                        delayedEnd: null,
                    };
                    batchPatients.push(patient);
                }

                // æ›´æ–°æ©Ÿå™¨æ™‚é–“
                machineTime = batchPatients[batchSize - 1].earlyEnd;

                // é€™ä¸€æ‰¹çš„ Delayedï¼ˆç·Šæ¥è‘— Early å®Œæˆå¾Œï¼Œä½†è¦é¿é–‹åˆä¼‘ï¼Œä¸”è¦æ»¿è¶³ minWaitLimitï¼‰
                for (let i = 0; i < batchSize; i++) {
                    const patient = batchPatients[i];
                    // ç¢ºä¿ç­‰å¾…æ™‚é–“ >= minWaitLimit
                    const minDelayedStart = patient.injTime + minWaitLimit;
                    let delayedStart = Math.max(machineTime, minDelayedStart);
                    delayedStart = adjustForLunch(delayedStart, delayedScanDuration);

                    patient.delayedStart = delayedStart;
                    patient.delayedEnd = delayedStart + delayedScanDuration;
                    machineTime = patient.delayedEnd;
                }

                batches.push({
                    batchNumber,
                    patients: batchPatients.map(p => p.id),
                    firstInj: batchPatients[0].injTime,
                    lastDelayedEnd: machineTime,
                });

                schedule.push(...batchPatients);
                patientId += batchSize;
                batchNumber++;
            }

            // ===== è¨ˆç®—çµ±è¨ˆè³‡è¨Š =====
            const waitTimes = schedule.map(p => p.delayedStart - p.injTime);
            const maxWait = Math.max(...waitTimes);
            const minWait = Math.min(...waitTimes);
            const firstInj = Math.min(...schedule.map(p => p.injTime));
            const lastEnd = Math.max(...schedule.map(p => p.delayedEnd));
            const totalDuration = lastEnd - firstInj;

            return {
                mode: batches.length === 1 ? 'BATCH' : 'AUTO_INTERLEAVED',
                schedule,
                batches,
                maxBatchSize,
                maxPatientWaitTime: maxWait,
                minPatientWaitTime: minWait,
                totalDuration,
                summary: batches.length === 1
                    ? `æ‰¹æ¬¡æ¨¡å¼ï¼š${n} ä½ç—…äººå¯ä¸€æ¬¡å®Œæˆ`
                    : `è‡ªå‹•åˆ†æ‰¹ï¼šåˆ† ${batches.length} æ‰¹è™•ç†ï¼Œæ¯æ‰¹æœ€å¤š ${maxBatchSize} äºº`,
            };
        };

        // ============ ç”Ÿæˆå·¥ä½œæ¸…å–® ============
        const generateWorklist = (schedule) => {
            const tasks = [];

            schedule.forEach((patient) => {
                tasks.push({
                    time: patient.earlyStart,
                    endTime: patient.earlyEnd,
                    type: 'EARLY',
                    patientId: patient.id,
                    duration: patient.earlyEnd - patient.earlyStart,
                });

                if (patient.delayedStart !== null) {
                    tasks.push({
                        time: patient.delayedStart,
                        endTime: patient.delayedEnd,
                        type: 'DELAYED',
                        patientId: patient.id,
                        duration: patient.delayedEnd - patient.delayedStart,
                    });
                }
            });

            tasks.sort((a, b) => a.time - b.time);
            return tasks;
        };

        // ============ é†«å¸«è¦åŠƒé¢æ¿ ============
        const PlannerTab = ({ schedule, result, config }) => {
            const ganttData = useMemo(() => {
                if (!schedule.length) return { tasks: [], minTime: 0, maxTime: 0 };

                const tasks = [];
                schedule.forEach((p) => {
                    tasks.push({ patientId: p.id, type: 'EARLY', start: p.earlyStart, end: p.earlyEnd });
                    if (p.delayedStart !== null) {
                        tasks.push({ patientId: p.id, type: 'DELAYED', start: p.delayedStart, end: p.delayedEnd });
                    }
                });

                const allTimes = tasks.flatMap(t => [t.start, t.end]);
                return { tasks, minTime: Math.min(...allTimes), maxTime: Math.max(...allTimes) };
            }, [schedule]);

            const getBarColor = (type) => {
                return type === 'EARLY'
                    ? 'background: linear-gradient(135deg, #93c5fd 0%, #60a5fa 100%)'
                    : 'background: linear-gradient(135deg, #fdba74 0%, #fb923c 100%)';
            };

            const getBarPosition = (start, end, minTime, maxTime) => {
                const totalDuration = maxTime - minTime || 1;
                const left = ((start - minTime) / totalDuration) * 100;
                const width = ((end - start) / totalDuration) * 100;
                return { left: `${left}%`, width: `${Math.max(width, 1)}%` };
            };

            const timeMarkers = useMemo(() => {
                if (!schedule.length) return [];
                const { minTime, maxTime } = ganttData;
                const markers = [];
                const start = Math.floor(minTime / 30) * 30;
                for (let t = start; t <= maxTime; t += 30) {
                    const pos = ((t - minTime) / (maxTime - minTime || 1)) * 100;
                    markers.push({ time: t, pos });
                }
                return markers;
            }, [ganttData, schedule.length]);

            return (
                <div style={{ display: 'flex', flexDirection: 'column', gap: '24px' }}>
                    {/* æ‰“è—¥æ™‚åˆ»è¡¨ */}
                    <div className="card printable-section" style={{ overflow: 'hidden' }}>
                        <div style={{
                            padding: '20px 24px',
                            borderBottom: '1px solid #f3e8ff',
                            background: 'linear-gradient(135deg, var(--lavender-50) 0%, var(--pink-50) 100%)'
                        }}>
                            <h3 style={{ margin: 0, fontSize: '18px', fontWeight: 700, color: 'var(--warm-gray-800)', display: 'flex', alignItems: 'center', gap: '10px' }}>
                                <i className="fa-solid fa-syringe" style={{ fontSize: '18px', color: '#e11d48' }}></i>
                                å»ºè­°æ‰“è—¥æ™‚åˆ»è¡¨
                            </h3>
                            <p style={{ margin: '6px 0 0 0', fontSize: '14px', color: 'var(--warm-gray-600)' }}>
                                å°‡æ­¤è¡¨äº¤çµ¦è­·ç†å¸«ï¼Œç…§è¡¨æ‰“è—¥å³å¯
                            </p>
                        </div>

                        <div style={{ overflowX: 'auto' }}>
                            <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: '14px' }}>
                                <thead>
                                    <tr style={{ background: 'var(--warm-gray-50)', color: 'var(--warm-gray-600)' }}>
                                        <th style={{ padding: '14px 16px', textAlign: 'left', fontWeight: 600 }}>åºè™Ÿ</th>
                                        <th style={{ padding: '14px 16px', textAlign: 'left', fontWeight: 600 }}>
                                            <i className="fa-solid fa-syringe" style={{ color: '#e11d48', marginRight: '6px' }}></i> æ‰“è—¥æ™‚é–“
                                        </th>
                                        <th style={{ padding: '14px 16px', textAlign: 'left', fontWeight: 600 }}>
                                            <i className="fa-solid fa-bolt" style={{ color: '#3b82f6', marginRight: '6px' }}></i> Early Scan
                                        </th>
                                        <th style={{ padding: '14px 16px', textAlign: 'left', fontWeight: 600 }}>
                                            <i className="fa-regular fa-clock" style={{ color: '#f97316', marginRight: '6px' }}></i> Delayed Scan
                                        </th>
                                        <th style={{ padding: '14px 16px', textAlign: 'left', fontWeight: 600 }}>
                                            ç­‰å¾…æ™‚é–“ <span style={{ fontSize: '11px', fontWeight: 400, color: 'var(--warm-gray-400)' }}>(æ‰“è—¥â†’Delayedé–‹å§‹)</span>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {schedule.map((p, idx) => {
                                        const waitTime = p.delayedStart - p.injTime;
                                        const isOverLimit = waitTime > config.maxWaitLimit;
                                        const isNewBatch = idx > 0 && schedule[idx - 1].batch !== p.batch;

                                        return (
                                            <tr
                                                key={p.id}
                                                className="table-row"
                                                style={{
                                                    borderBottom: '1px solid var(--warm-gray-100)',
                                                    transition: 'background 0.15s',
                                                    borderTop: isNewBatch ? '3px solid #93c5fd' : 'none'
                                                }}
                                            >
                                                <td style={{ padding: '14px 16px', fontWeight: 600, color: 'var(--warm-gray-800)' }}>
                                                    ç—…äºº {p.id}
                                                    {result.batches && result.batches.length > 1 && (
                                                        <span style={{
                                                            marginLeft: '8px',
                                                            fontSize: '11px',
                                                            background: `hsl(${210 + (p.batch - 1) * 30}, 80%, 85%)`,
                                                            color: `hsl(${210 + (p.batch - 1) * 30}, 60%, 35%)`,
                                                            padding: '2px 8px',
                                                            borderRadius: '10px'
                                                        }}>
                                                            ç¬¬ {p.batch} æ‰¹
                                                        </span>
                                                    )}
                                                </td>
                                                <td style={{ padding: '14px 16px', color: '#e11d48', fontWeight: 700 }}>
                                                    {minutesToTime(p.injTime)}
                                                </td>
                                                <td style={{ padding: '14px 16px', color: '#2563eb', fontWeight: 500 }}>
                                                    {minutesToTime(p.earlyStart)}-{minutesToTime(p.earlyEnd)}
                                                </td>
                                                <td style={{ padding: '14px 16px', color: '#ea580c', fontWeight: 500 }}>
                                                    {p.delayedStart ? `${minutesToTime(p.delayedStart)}-${minutesToTime(p.delayedEnd)}` : '-'}
                                                </td>
                                                <td style={{ padding: '14px 16px' }}>
                                                    <span style={{
                                                        color: isOverLimit ? '#dc2626' : '#16a34a',
                                                        fontWeight: 600
                                                    }}>
                                                        {Math.floor(waitTime / 60)}h {waitTime % 60}m
                                                        {isOverLimit && ' âš ï¸'}
                                                    </span>
                                                </td>
                                            </tr>
                                        );
                                    })}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    {/* ç”˜ç‰¹åœ– - æ ¼å­ç‹€æ™‚é–“è»¸ */}
                    {schedule.length > 0 && (() => {
                        // è¨ˆç®—æ™‚é–“ç¯„åœï¼Œå°é½Šåˆ°30åˆ†é˜
                        const allTimes = schedule.flatMap(p => [p.earlyStart, p.earlyEnd, p.delayedStart, p.delayedEnd].filter(t => t !== null));
                        const rawMin = Math.min(...allTimes);
                        const rawMax = Math.max(...allTimes);
                        const gridStart = Math.floor(rawMin / 30) * 30;
                        const gridEnd = Math.ceil(rawMax / 30) * 30;
                        const totalCells = (gridEnd - gridStart) / 5; // æ¯5åˆ†é˜ä¸€æ ¼
                        const cellWidth = 18; // æ¯æ ¼å¯¬åº¦(px)

                        // ç”Ÿæˆæ™‚é–“æ¨™è¨˜ï¼ˆæ¯30åˆ†é˜ï¼‰
                        const hourMarkers = [];
                        for (let t = gridStart; t <= gridEnd; t += 30) {
                            hourMarkers.push(t);
                        }

                        // åˆ¤æ–·ä»»å‹™ä½”ç”¨å“ªäº›æ ¼å­
                        const getCellRange = (start, end) => {
                            const startCell = Math.floor((start - gridStart) / 5);
                            const endCell = Math.ceil((end - gridStart) / 5);
                            return { startCell, endCell, span: endCell - startCell };
                        };

                        return (
                            <div className="card" style={{ overflow: 'hidden' }}>
                                <div style={{
                                    padding: '20px 24px',
                                    borderBottom: '1px solid #dbeafe',
                                    background: 'linear-gradient(135deg, var(--mint-50) 0%, #ecfeff 100%)'
                                }}>
                                    <h3 style={{ margin: 0, fontSize: '18px', fontWeight: 700, color: 'var(--warm-gray-800)', display: 'flex', alignItems: 'center', gap: '10px' }}>
                                        <span style={{ fontSize: '20px' }}>ğŸ“Š</span>
                                        æ©Ÿå™¨ä½¿ç”¨æ™‚é–“è»¸
                                        <span style={{ fontSize: '12px', fontWeight: 400, color: 'var(--warm-gray-500)', marginLeft: '8px' }}>
                                            ï¼ˆæ¯å°æ ¼ 5 åˆ†é˜ï¼‰
                                        </span>
                                    </h3>
                                </div>

                                <div style={{ padding: '24px', overflowX: 'auto' }}>
                                    {/* åœ–ä¾‹ */}
                                    <div style={{ display: 'flex', gap: '24px', marginBottom: '20px', fontSize: '13px' }}>
                                        <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                            <div style={{ width: '16px', height: '16px', borderRadius: '4px', background: 'linear-gradient(135deg, #93c5fd 0%, #60a5fa 100%)' }}></div>
                                            <span style={{ color: 'var(--warm-gray-600)' }}>Early Scan</span>
                                        </div>
                                        <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                            <div style={{ width: '16px', height: '16px', borderRadius: '4px', background: 'linear-gradient(135deg, #fdba74 0%, #fb923c 100%)' }}></div>
                                            <span style={{ color: 'var(--warm-gray-600)' }}>Delayed Scan</span>
                                        </div>
                                        <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                            <div style={{ width: '16px', height: '16px', borderRadius: '4px', background: 'var(--warm-gray-100)', border: '1px solid var(--warm-gray-200)' }}></div>
                                            <span style={{ color: 'var(--warm-gray-600)' }}>ç©ºé–’</span>
                                        </div>
                                    </div>

                                    <div style={{ display: 'inline-block', minWidth: 'fit-content' }}>
                                        {/* æ™‚é–“è»¸æ¨™é ­ */}
                                        <div style={{ display: 'flex', alignItems: 'flex-end', marginBottom: '4px', paddingLeft: '70px' }}>
                                            {hourMarkers.map((t, idx) => (
                                                <div key={idx} style={{
                                                    width: `${cellWidth * 6}px`,
                                                    textAlign: 'left',
                                                    fontSize: '11px',
                                                    fontWeight: 600,
                                                    color: 'var(--warm-gray-600)'
                                                }}>
                                                    {minutesToTime(t)}
                                                </div>
                                            ))}
                                        </div>

                                        {/* æ ¼å­è¡¨æ ¼ */}
                                        <div style={{ display: 'flex', flexDirection: 'column', gap: '4px' }}>
                                            {schedule.map((patient) => {
                                                const earlyRange = getCellRange(patient.earlyStart, patient.earlyEnd);
                                                const delayedRange = patient.delayedStart ? getCellRange(patient.delayedStart, patient.delayedEnd) : null;

                                                return (
                                                    <div key={patient.id} style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>
                                                        <div style={{ width: '60px', fontSize: '13px', color: 'var(--warm-gray-600)', fontWeight: 500, textAlign: 'right' }}>
                                                            ç—…äºº {patient.id}
                                                        </div>
                                                        <div style={{ display: 'flex' }}>
                                                            {Array.from({ length: totalCells }, (_, cellIdx) => {
                                                                const isEarly = cellIdx >= earlyRange.startCell && cellIdx < earlyRange.endCell;
                                                                const isDelayed = delayedRange && cellIdx >= delayedRange.startCell && cellIdx < delayedRange.endCell;
                                                                const is30MinBorder = (cellIdx + 1) % 6 === 0;

                                                                let bg = 'var(--warm-gray-50)';
                                                                let title = '';
                                                                if (isEarly) {
                                                                    bg = 'linear-gradient(135deg, #93c5fd 0%, #60a5fa 100%)';
                                                                    title = `Early: ${minutesToTime(patient.earlyStart)} - ${minutesToTime(patient.earlyEnd)}`;
                                                                } else if (isDelayed) {
                                                                    bg = 'linear-gradient(135deg, #fdba74 0%, #fb923c 100%)';
                                                                    title = `Delayed: ${minutesToTime(patient.delayedStart)} - ${minutesToTime(patient.delayedEnd)}`;
                                                                }

                                                                return (
                                                                    <div
                                                                        key={cellIdx}
                                                                        title={title}
                                                                        style={{
                                                                            width: `${cellWidth}px`,
                                                                            height: '24px',
                                                                            background: bg,
                                                                            borderRight: is30MinBorder ? '2px solid var(--warm-gray-300)' : '1px solid var(--warm-gray-200)',
                                                                            borderTop: '1px solid var(--warm-gray-200)',
                                                                            borderBottom: '1px solid var(--warm-gray-200)',
                                                                            borderLeft: cellIdx === 0 ? '2px solid var(--warm-gray-300)' : 'none',
                                                                            transition: 'transform 0.15s',
                                                                            cursor: (isEarly || isDelayed) ? 'pointer' : 'default',
                                                                        }}
                                                                        onMouseOver={(e) => {
                                                                            if (isEarly || isDelayed) e.target.style.transform = 'scaleY(1.2)';
                                                                        }}
                                                                        onMouseOut={(e) => {
                                                                            e.target.style.transform = 'scaleY(1)';
                                                                        }}
                                                                    ></div>
                                                                );
                                                            })}
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        );
                    })()}

                    {/* åˆ—å°ç°½åæ¬„ */}
                    <div className="print-only" style={{ background: 'white', padding: '24px', marginTop: '32px', borderTop: '2px solid var(--warm-gray-300)' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                            <p style={{ fontSize: '14px', color: 'var(--warm-gray-600)' }}>æ’ç¨‹é†«å¸«ç°½åï¼š__________________</p>
                            <p style={{ fontSize: '14px', color: 'var(--warm-gray-600)' }}>åˆ—å°æ—¥æœŸï¼š{new Date().toLocaleDateString('zh-TW')}</p>
                        </div>
                    </div>
                </div>
            );
        };

        // ============ æ”¾å°„å¸«å·¥ä½œæ¸…å–® ============
        const WorklistTab = ({ schedule, result }) => {
            const [completedTasks, setCompletedTasks] = useState({});
            const worklist = useMemo(() => generateWorklist(schedule), [schedule]);

            const toggleComplete = (index) => {
                setCompletedTasks(prev => ({ ...prev, [index]: !prev[index] }));
            };

            const completedCount = Object.values(completedTasks).filter(Boolean).length;
            const progress = worklist.length > 0 ? (completedCount / worklist.length) * 100 : 0;

            return (
                <div style={{ display: 'flex', flexDirection: 'column', gap: '24px' }}>
                    {/* å·¥ä½œæ¸…å–® */}
                    <div className="card printable-section" style={{ overflow: 'hidden' }}>
                        <div style={{
                            padding: '20px 24px',
                            borderBottom: '1px solid #dcfce7',
                            background: 'linear-gradient(135deg, var(--mint-50) 0%, var(--mint-100) 100%)'
                        }}>
                            <h3 style={{ margin: 0, fontSize: '18px', fontWeight: 700, color: 'var(--warm-gray-800)', display: 'flex', alignItems: 'center', gap: '10px' }}>
                                <i className="fa-solid fa-clipboard-check" style={{ fontSize: '18px', color: '#16a34a' }}></i>
                                åŸ·è¡Œæ¸…å–®
                            </h3>
                            <p style={{ margin: '6px 0 0 0', fontSize: '14px', color: 'var(--warm-gray-600)' }}>
                                ä¾æ™‚é–“æ’åºï¼Œç…§é †åºåŸ·è¡Œå³å¯
                            </p>
                        </div>

                        <div>
                            {worklist.map((task, idx) => {
                                const isDelayed = task.type === 'DELAYED';

                                return (
                                    <div
                                        key={idx}
                                        style={{
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '16px',
                                            padding: '14px 24px',
                                            borderBottom: '1px solid var(--warm-gray-100)',
                                            flexWrap: 'wrap'
                                        }}
                                    >
                                        {/* åºè™Ÿ */}
                                        <div style={{
                                            width: '28px',
                                            height: '28px',
                                            borderRadius: '50%',
                                            background: 'var(--warm-gray-200)',
                                            color: 'var(--warm-gray-600)',
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            fontSize: '13px',
                                            fontWeight: 600
                                        }}>
                                            {idx + 1}
                                        </div>

                                        {/* æ™‚é–“ */}
                                        <div style={{ minWidth: '100px' }}>
                                            <div style={{
                                                fontSize: '17px',
                                                fontWeight: 700,
                                                color: 'var(--warm-gray-800)'
                                            }}>
                                                {minutesToTime(task.time)}-{minutesToTime(task.endTime)}
                                            </div>
                                        </div>

                                        {/* ç—…äººç·¨è™Ÿ */}
                                        <div style={{
                                            minWidth: '70px',
                                            fontWeight: 600,
                                            color: 'var(--warm-gray-700)'
                                        }}>
                                            ç—…äºº {task.patientId}
                                        </div>

                                        {/* ä»»å‹™é¡å‹ */}
                                        <div>
                                            {isDelayed ? (
                                                <span style={{
                                                    display: 'inline-flex',
                                                    alignItems: 'center',
                                                    gap: '6px',
                                                    padding: '5px 12px',
                                                    borderRadius: '16px',
                                                    background: 'linear-gradient(135deg, #ffedd5 0%, #fed7aa 100%)',
                                                    color: '#c2410c',
                                                    fontSize: '13px',
                                                    fontWeight: 600
                                                }}>
                                                    <i className="fa-regular fa-clock" style={{ marginRight: '4px' }}></i> Delayed
                                                </span>
                                            ) : (
                                                <span style={{
                                                    display: 'inline-flex',
                                                    alignItems: 'center',
                                                    gap: '6px',
                                                    padding: '5px 12px',
                                                    borderRadius: '16px',
                                                    background: 'linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%)',
                                                    color: '#1d4ed8',
                                                    fontSize: '13px',
                                                    fontWeight: 600
                                                }}>
                                                    <i className="fa-solid fa-bolt" style={{ marginRight: '4px' }}></i> Early
                                                </span>
                                            )}
                                        </div>

                                        {/* å·¥æ™‚ */}
                                        <div style={{ fontSize: '13px', color: 'var(--warm-gray-500)', marginLeft: 'auto' }}>
                                            {task.duration}min
                                        </div>
                                    </div>
                                );
                            })}

                            {worklist.length === 0 && (
                                <div style={{ padding: '48px', textAlign: 'center', color: 'var(--warm-gray-400)' }}>
                                    <i className="fa-regular fa-folder-open" style={{ fontSize: '40px', marginBottom: '12px', display: 'block' }}></i>
                                    <p>å°šæœªç”¢ç”Ÿæ’ç¨‹</p>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* åˆ—å°ç°½åæ¬„ */}
                    <div className="print-only" style={{ background: 'white', padding: '24px', marginTop: '32px', borderTop: '2px solid var(--warm-gray-300)' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                            <p style={{ fontSize: '14px', color: 'var(--warm-gray-600)' }}>åŸ·è¡Œæ”¾å°„å¸«ç°½åï¼š__________________</p>
                            <p style={{ fontSize: '14px', color: 'var(--warm-gray-600)' }}>æ—¥æœŸï¼š{new Date().toLocaleDateString('zh-TW')}</p>
                        </div>
                    </div>
                </div>
            );
        };

        // ============ ä¸»æ‡‰ç”¨ç¨‹å¼ ============
        const App = () => {
            const [patientCount, setPatientCount] = useState(5);
            const [config, setConfig] = useState(DEFAULT_CONFIG);
            const [activeTab, setActiveTab] = useState('planner');

            const result = useMemo(() => calculateSchedule(patientCount, config), [patientCount, config]);

            const handlePrint = () => window.print();

            const handleConfigChange = (key, value) => {
                setConfig(prev => ({ ...prev, [key]: value }));
            };

            return (
                <div style={{ minHeight: '100vh' }}>
                    {/* é ‚éƒ¨å°èˆª */}
                    <header className="no-print" style={{
                        background: 'linear-gradient(135deg, #fce7f3 0%, #e9d5ff 50%, #dbeafe 100%)',
                        borderBottom: '1px solid rgba(0,0,0,0.05)',
                        padding: '16px 0'
                    }}>
                        <div style={{ maxWidth: '1000px', margin: '0 auto', padding: '0 20px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                                <div style={{
                                    width: '44px',
                                    height: '44px',
                                    background: 'white',
                                    borderRadius: '14px',
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    boxShadow: '0 2px 8px rgba(0,0,0,0.06)',
                                    fontSize: '22px'
                                }}>
                                    ğŸ©º
                                </div>
                                <div>
                                    <h1 style={{ margin: 0, fontSize: '20px', fontWeight: 700, color: 'var(--warm-gray-800)' }}>
                                        PET æ™ºæ…§æ’ç¨‹åŠ©æ‰‹
                                    </h1>
                                    <p style={{ margin: 0, fontSize: '12px', color: 'var(--warm-gray-600)' }}>Smart PET Scheduler</p>
                                </div>
                            </div>

                            <button onClick={handlePrint} className="btn-soft" style={{
                                display: 'flex',
                                alignItems: 'center',
                                gap: '8px',
                                padding: '10px 18px',
                                background: 'white',
                                border: 'none',
                                borderRadius: '12px',
                                cursor: 'pointer',
                                fontSize: '14px',
                                fontWeight: 600,
                                color: 'var(--warm-gray-700)',
                                boxShadow: '0 2px 8px rgba(0,0,0,0.06)'
                            }}>
                                ğŸ–¨ï¸ åˆ—å°
                            </button>
                        </div>
                    </header>

                    <main style={{ maxWidth: '1000px', margin: '0 auto', padding: '24px 20px' }}>
                        {/* åƒæ•¸è¼¸å…¥å€ */}
                        <div className="no-print card" style={{ marginBottom: '24px', overflow: 'hidden' }}>
                            <div style={{ padding: '24px' }}>
                                <div style={{ display: 'flex', flexWrap: 'wrap', alignItems: 'flex-end', gap: '24px' }}>
                                    {/* ç—…äººæ•¸é‡ */}
                                    <div style={{ flex: '1', minWidth: '200px' }}>
                                        <label style={{ display: 'block', fontSize: '13px', fontWeight: 600, color: 'var(--warm-gray-600)', marginBottom: '8px' }}>
                                            ä»Šæ—¥ç—…äººæ•¸é‡
                                        </label>
                                        <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                                            <button onClick={() => setPatientCount(Math.max(0, patientCount - 1))} className="btn-soft" style={{
                                                width: '40px', height: '40px', borderRadius: '12px',
                                                background: 'var(--pink-100)', border: 'none', cursor: 'pointer',
                                                fontSize: '18px', color: 'var(--pink-500)'
                                            }}>âˆ’</button>
                                            <input
                                                type="number"
                                                value={patientCount}
                                                onChange={(e) => setPatientCount(Math.max(0, parseInt(e.target.value) || 0))}
                                                className="input-soft"
                                                style={{ width: '70px', textAlign: 'center', fontSize: '22px', fontWeight: 700 }}
                                            />
                                            <button onClick={() => setPatientCount(patientCount + 1)} className="btn-soft" style={{
                                                width: '40px', height: '40px', borderRadius: '12px',
                                                background: 'var(--pink-100)', border: 'none', cursor: 'pointer',
                                                fontSize: '18px', color: 'var(--pink-500)'
                                            }}>+</button>
                                            <span style={{ color: 'var(--warm-gray-500)' }}>ä½</span>
                                        </div>
                                    </div>

                                    {/* é–‹å§‹æ™‚é–“ */}
                                    <div>
                                        <label style={{ display: 'block', fontSize: '13px', fontWeight: 600, color: 'var(--warm-gray-600)', marginBottom: '8px' }}>
                                            é–‹å§‹æ‰“è—¥æ™‚é–“
                                        </label>
                                        <input
                                            type="time"
                                            value={config.startTime}
                                            onChange={(e) => handleConfigChange('startTime', e.target.value)}
                                            className="input-soft"
                                        />
                                    </div>

                                    {/* Early Scan */}
                                    <div>
                                        <label style={{ display: 'block', fontSize: '13px', fontWeight: 600, color: 'var(--warm-gray-600)', marginBottom: '8px' }}>
                                            Early Scan (åˆ†é˜)
                                        </label>
                                        <input
                                            type="number"
                                            value={config.earlyScanDuration}
                                            onChange={(e) => handleConfigChange('earlyScanDuration', parseInt(e.target.value) || 0)}
                                            className="input-soft"
                                            style={{ width: '80px' }}
                                        />
                                    </div>

                                    {/* Delayed Scan */}
                                    <div>
                                        <label style={{ display: 'block', fontSize: '13px', fontWeight: 600, color: 'var(--warm-gray-600)', marginBottom: '8px' }}>
                                            Delayed Scan (åˆ†é˜) <span style={{ fontSize: '11px', fontWeight: 400, color: 'var(--warm-gray-400)' }}>0=ä¸éœ€è¦</span>
                                        </label>
                                        <input
                                            type="number"
                                            min="0"
                                            value={config.delayedScanDuration}
                                            onChange={(e) => handleConfigChange('delayedScanDuration', Math.max(0, parseInt(e.target.value) || 0))}
                                            className="input-soft"
                                            style={{ width: '80px' }}
                                        />
                                    </div>

                                    {/* Uptake Time */}
                                    <div>
                                        <label style={{ display: 'block', fontSize: '13px', fontWeight: 600, color: 'var(--warm-gray-600)', marginBottom: '8px' }}>
                                            Uptake Time (åˆ†é˜)
                                        </label>
                                        <input
                                            type="number"
                                            value={config.uptakeTime}
                                            onChange={(e) => handleConfigChange('uptakeTime', parseInt(e.target.value) || 0)}
                                            className="input-soft"
                                            style={{ width: '80px' }}
                                        />
                                    </div>

                                    {/* æœ€å°ç­‰å¾…æ™‚é–“ */}
                                    <div>
                                        <label style={{ display: 'block', fontSize: '13px', fontWeight: 600, color: 'var(--warm-gray-600)', marginBottom: '8px' }}>
                                            æœ€å°ç­‰å¾… (åˆ†é˜)
                                        </label>
                                        <input
                                            type="number"
                                            value={config.minWaitLimit}
                                            onChange={(e) => handleConfigChange('minWaitLimit', parseInt(e.target.value) || 0)}
                                            className="input-soft"
                                            style={{ width: '80px' }}
                                        />
                                    </div>

                                    {/* æœ€å¤§ç­‰å¾…æ™‚é–“ */}
                                    <div>
                                        <label style={{ display: 'block', fontSize: '13px', fontWeight: 600, color: 'var(--warm-gray-600)', marginBottom: '8px' }}>
                                            æœ€å¤§ç­‰å¾… (åˆ†é˜)
                                        </label>
                                        <input
                                            type="number"
                                            value={config.maxWaitLimit}
                                            onChange={(e) => handleConfigChange('maxWaitLimit', parseInt(e.target.value) || 0)}
                                            className="input-soft"
                                            style={{ width: '80px' }}
                                        />
                                    </div>
                                </div>

                                {/* åˆä¼‘æ™‚é–“è¨­å®š */}
                                <div style={{
                                    marginTop: '16px',
                                    padding: '16px',
                                    background: 'var(--warm-gray-50)',
                                    borderRadius: '12px',
                                    border: '1px solid var(--warm-gray-100)'
                                }}>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: config.lunchBreakEnabled ? '16px' : '0' }}>
                                        <label style={{
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '8px',
                                            cursor: 'pointer',
                                            fontSize: '14px',
                                            fontWeight: 600,
                                            color: 'var(--warm-gray-700)'
                                        }}>
                                            <input
                                                type="checkbox"
                                                checked={config.lunchBreakEnabled}
                                                onChange={(e) => handleConfigChange('lunchBreakEnabled', e.target.checked)}
                                                style={{
                                                    width: '18px',
                                                    height: '18px',
                                                    accentColor: 'var(--pink-400)'
                                                }}
                                            />
                                            ğŸ” ä¸­åˆç©ºæ©Ÿæ™‚é–“
                                        </label>
                                        <span style={{ fontSize: '12px', color: 'var(--warm-gray-500)' }}>
                                            ï¼ˆæ©Ÿå™¨ä¼‘æ¯ï¼Œä½†å¯ç¹¼çºŒæ‰“è—¥ï¼‰
                                        </span>
                                    </div>

                                    {config.lunchBreakEnabled && (
                                        <div style={{ display: 'flex', alignItems: 'center', gap: '16px', flexWrap: 'wrap' }}>
                                            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                                <label style={{ fontSize: '13px', color: 'var(--warm-gray-600)' }}>é–‹å§‹</label>
                                                <input
                                                    type="time"
                                                    value={config.lunchBreakStart}
                                                    onChange={(e) => handleConfigChange('lunchBreakStart', e.target.value)}
                                                    className="input-soft"
                                                    style={{ width: '110px' }}
                                                />
                                            </div>
                                            <span style={{ color: 'var(--warm-gray-400)' }}>â†’</span>
                                            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                                <label style={{ fontSize: '13px', color: 'var(--warm-gray-600)' }}>çµæŸ</label>
                                                <input
                                                    type="time"
                                                    value={config.lunchBreakEnd}
                                                    onChange={(e) => handleConfigChange('lunchBreakEnd', e.target.value)}
                                                    className="input-soft"
                                                    style={{ width: '110px' }}
                                                />
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* æ¨¡å¼ç‹€æ…‹ */}
                            {patientCount > 0 && (
                                <div style={{
                                    padding: '14px 24px',
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'space-between',
                                    flexWrap: 'wrap',
                                    gap: '12px',
                                    borderTop: '1px solid var(--warm-gray-100)',
                                    background: result.mode === 'BATCH'
                                        ? 'linear-gradient(90deg, #dcfce7 0%, #bbf7d0 100%)'
                                        : result.mode === 'AUTO_INTERLEAVED'
                                            ? 'linear-gradient(90deg, #dbeafe 0%, #bfdbfe 100%)'
                                            : result.mode === 'EARLY_ONLY'
                                                ? 'linear-gradient(90deg, #fef3c7 0%, #fde68a 100%)'
                                                : result.mode === 'ERROR'
                                                    ? 'linear-gradient(90deg, #fee2e2 0%, #fecaca 100%)'
                                                    : 'var(--warm-gray-50)'
                                }}>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px', flexWrap: 'wrap' }}>
                                        {result.mode === 'BATCH' && (
                                            <>
                                                <i className="fa-solid fa-check-circle" style={{ fontSize: '20px', color: '#166534' }}></i>
                                                <span style={{ fontWeight: 700, color: '#166534' }}>æ‰¹æ¬¡æ¨¡å¼</span>
                                                <span style={{ fontSize: '13px', color: '#15803d' }}>ä¾åºå®Œæˆæ‰€æœ‰ Early å¾Œå†åš Delayed</span>
                                            </>
                                        )}
                                        {result.mode === 'AUTO_INTERLEAVED' && (
                                            <>
                                                <i className="fa-solid fa-arrows-rotate" style={{ fontSize: '20px', color: '#1e40af' }}></i>
                                                <span style={{ fontWeight: 700, color: '#1e40af' }}>è‡ªå‹•å„ªåŒ–æ’ç¨‹</span>
                                                <span style={{ fontSize: '13px', color: '#1d4ed8' }}>
                                                    {result.summary}
                                                </span>
                                            </>
                                        )}
                                        {result.mode === 'EARLY_ONLY' && (
                                            <>
                                                <i className="fa-solid fa-bolt" style={{ fontSize: '20px', color: '#92400e' }}></i>
                                                <span style={{ fontWeight: 700, color: '#92400e' }}>åƒ… Early Scan</span>
                                                <span style={{ fontSize: '13px', color: '#a16207' }}>ç—…äººä¸éœ€è¦ Delayed Scan</span>
                                            </>
                                        )}
                                        {result.mode === 'ERROR' && (
                                            <>
                                                <i className="fa-solid fa-circle-xmark" style={{ fontSize: '20px', color: '#dc2626' }}></i>
                                                <span style={{ fontWeight: 700, color: '#dc2626' }}>åƒæ•¸éŒ¯èª¤</span>
                                                <span style={{ fontSize: '13px', color: '#b91c1c' }}>{result.error}</span>
                                            </>
                                        )}
                                    </div>

                                    {result.maxPatientWaitTime && (
                                        <div style={{ display: 'flex', alignItems: 'center', gap: '16px', fontSize: '13px' }}>
                                            <div style={{ color: 'var(--warm-gray-600)' }}>
                                                æœ€é•·ç­‰å¾…ï¼š
                                                <span style={{ fontWeight: 700, marginLeft: '4px', color: '#16a34a' }}>
                                                    {Math.floor(result.maxPatientWaitTime / 60)}h {result.maxPatientWaitTime % 60}m
                                                </span>
                                            </div>
                                            {result.batches && result.batches.length > 1 && (
                                                <div style={{ color: 'var(--warm-gray-600)' }}>
                                                    ç¸½å…± <span style={{ fontWeight: 700, color: '#1d4ed8' }}>{result.batches.length}</span> æ‰¹
                                                </div>
                                            )}
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>

                        {/* Tab åˆ‡æ› */}
                        <div className="no-print" style={{ display: 'flex', gap: '10px', marginBottom: '24px' }}>
                            <button
                                onClick={() => setActiveTab('planner')}
                                className="btn-soft"
                                style={{
                                    display: 'flex', alignItems: 'center', gap: '8px',
                                    padding: '12px 24px', borderRadius: '14px', border: 'none',
                                    cursor: 'pointer', fontSize: '14px', fontWeight: 600,
                                    background: activeTab === 'planner'
                                        ? 'linear-gradient(135deg, #e9d5ff 0%, #f5d0fe 100%)'
                                        : 'white',
                                    color: activeTab === 'planner' ? '#7c3aed' : 'var(--warm-gray-600)',
                                    boxShadow: activeTab === 'planner' ? '0 4px 14px rgba(124, 58, 237, 0.15)' : '0 2px 8px rgba(0,0,0,0.04)'
                                }}
                            >
                                <i className="fa-solid fa-clipboard-list" style={{ marginRight: '6px' }}></i> é†«å¸«è¦åŠƒ
                            </button>
                            <button
                                onClick={() => setActiveTab('worklist')}
                                className="btn-soft"
                                style={{
                                    display: 'flex', alignItems: 'center', gap: '8px',
                                    padding: '12px 24px', borderRadius: '14px', border: 'none',
                                    cursor: 'pointer', fontSize: '14px', fontWeight: 600,
                                    background: activeTab === 'worklist'
                                        ? 'linear-gradient(135deg, #bbf7d0 0%, #86efac 100%)'
                                        : 'white',
                                    color: activeTab === 'worklist' ? '#166534' : 'var(--warm-gray-600)',
                                    boxShadow: activeTab === 'worklist' ? '0 4px 14px rgba(22, 101, 52, 0.15)' : '0 2px 8px rgba(0,0,0,0.04)'
                                }}
                            >
                                <i className="fa-solid fa-list-check" style={{ marginRight: '6px' }}></i> æ”¾å°„å¸«æ¸…å–®
                            </button>
                        </div>

                        {/* Tab å…§å®¹ */}
                        {activeTab === 'planner' ? (
                            <PlannerTab schedule={result.schedule} result={result} config={config} />
                        ) : (
                            <WorklistTab schedule={result.schedule} result={result} />
                        )}
                    </main>

                    {/* é è…³ */}
                    <footer className="no-print" style={{
                        marginTop: '48px',
                        padding: '20px',
                        textAlign: 'center',
                        fontSize: '13px',
                        color: 'var(--warm-gray-400)'
                    }}>
                        <i className="fa-regular fa-star" style={{ marginRight: '6px' }}></i> PET æ™ºæ…§æ’ç¨‹åŠ©æ‰‹ v2.0 | åƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›æ“ä½œè«‹ä¾è‡¨åºŠåˆ¤æ–·
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>